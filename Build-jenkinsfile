pipeline {
    	    agent {label "Build_Server"}
    	    //agent any
	    environment {
            build_package = "/home/ubuntu/Build_Server/workspace/CodeBuild@2/target/demo1.war"
	    }
	        stages 
                {
     	        //STAGE-1
	                stage ("This stage will build the code!") 
	                {
                        steps 
	                        {
                                node ("Build_Server")
		                            {
		                                checkout scmGit(branches: [[name: '*/jenkinsBranch']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/SaurabhVikas/jenkins.git']])
		                                sh "mvn clean"
                                        sh "mvn install"
		                            }
                            }
                    }
	            //STAGE-2
                    stage ("This stage will copy the package from build server to a S3 bucket.")
	                {
                        steps 
	                        {
		                        node ("Build_Server")
		                            {
                                        sh "aws s3 cp {env.build_package} s3://sankalpkabucket"
                                    }
	                        }
                    }
	            //STAGE-3
	                stage ("This will stash the package on build server.")
	                {
                        steps 
	                        {
		                        node ("Build_Server")
		                            {
                                        stash( includes:"target/demo1.war", name: "stashedCode")
                                    }
	                        }
                    }
}
}
